{% comment %}
    Renders 'boolean' or 'list' facets (filtering)

    Accepts:
    - idPrefix: {String} DOM `id`
    - context: {String} Rendering context, `mobile` or `desktop`
    - contextForloop: {Object} loop context from the parent
    - filter: {Object} Facet data
{% endcomment %}

<div
    id="{{ idPrefix }}{{ contextForloop.index }}-{{ section.id }}"
    class="js-filter"
    data-index="{{context}}-{{ contextForloop.index }}"
>
    <button
        type="button"
        class="w-full pt-5 pb-4 box-border"
        data-facet-accordion-toggle
        aria-label="{{ filter.label }} ({{ 'products.facets.filters_selected.one' | t: count: filter.active_values.size }})"
    >
        <div class="flex items-center">
            <span class="mr-2 body-r font-semibold
                {%- if context == 'desktop' %} large:text-body-r{% endif %}"
            >
                {{ filter.label | escape }}
            </span>
            <div
                class="flex justify-center items-center ml-auto transition-transform duration-300 transform bg-uiMidGrey w-[1.3rem] h-[1.3rem] [&.is-active]:-scale-y-100                    {%- if context == 'desktop'%} is-active{% endif %}"
                data-facet-accordion-arrow
                >
                {% render 'icon-caret' %}
            </div>
        </div>
    </button>
    <div
        id="Facet-{{ contextForloop.index }}-{{ section.id }}"
        {% if context == 'mobile' %}class="h-0 hidden"{% endif %}
        data-facet-accordion
    >
        <fieldset
            class="pb-5
                {%- if context == 'desktop' %} large:pb-6{% endif %}">
            <legend class="sr-only">
                {{- filter.label | escape -}}
            </legend>
            <ul class="grid
                {%- if columns == 2 %} grid-cols-2{% elsif columns == 3 %} grid-cols-3{% else %} grid-cols-1{% endif %}
                gap-[0.375rem]"
                role="list"
            >
                {%- for value in filter.values -%}
                    <li class="col-span-1">
                        <label
                            class="box-border relative z-0 flex py-[0.5625rem] px-[1.125rem] h-full cursor-pointer group
                            {%- if value.count == 0 and value.active == false %} pointer-events-none opacity-30{% endif %}
                            for="Filter-{{ filter.label | escape | handle }}-{{ forloop.index }}"
                        >
                            <input
                                id="Filter-{{ filter.label | escape | handle }}-{{ forloop.index }}"
                                class="appearance-none peer"
                                type="checkbox"
                                name="{{ value.param_name }}"
                                value="{{ value.value }}"
                                {% if value.active %}
                                    checked
                                {% endif %}
                                {% if value.count == 0 and value.active == false %}
                                    disabled
                                {% endif %}
                            >
                            <span class="absolute top-0 left-0 -z-10 w-full h-full border rounded-sm transition-colors duration-300 border-uiDarkGrey bg-transparent peer-focus-keyboard:outline peer-checked:border-primary peer-checked:bg-primary group-hover:border-primary group-hover:bg-uiMidGrey"></span>
                            <span class="block text-body-s transition-colors duration-300 peer-checked:text-text2 group-hover:text-primary">
                                {{ value.label | escape }} ({{ value.count }})
                            </span>
                            <span class="hidden">
                                {{ value.label | escape }} (
                                {%- if value.count == 1 -%}
                                    {{- 'products.facets.product_count_simple.one' | t: count: value.count -}}
                                {%- else -%}
                                    {{- 'products.facets.product_count_simple.other' | t: count: value.count -}}
                                {%- endif -%}
                                )
                            </span>
                        </label>
                    </li>
                {%- endfor -%}
            </ul>
        </fieldset>
    </div>
</div>