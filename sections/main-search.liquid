{{ 'search.css' | asset_url | stylesheet_tag }}

<script src="{{ 'search.js' | asset_url }}" defer="defer"></script>

{%- liquid
    assign sort_by = search.sort_by | default: search.default_sort_by
    assign terms = search.terms | escape
    assign search_url = '?q=' | append: terms | append: '&options%5Bprefix%5D=last&sort_by=' | append: sort_by
-%}

<div>
    <div class="container">
        <div class="wrap mb-12">
            <div class="mt-[1.4rem] mb-8 large:mt-[4.375rem] large:mb-10">
                <h1 class="heading-m">
                    {%- if search.performed -%}
                        {{- 'templates.search.title' | t -}}
                    {%- else -%}
                        {{- 'general.search.search' | t -}}
                    {%- endif -%}
                </h1>
            </div>
            <div class="large:max-w-[43.75rem]">
                {%- if settings.predictive_search_enabled -%}
                    <predictive-search data-loading-text="{{ 'accessibility.loading' | t }}" data-focusout-close>
                {%- endif -%}
                    <form action="{{ routes.search_url }}" method="get" role="search" class="search">
                        <div class="field m-0">
                            <label class="sr-only" for="Search-In-Template">
                                {{- 'general.search.search' | t -}}
                            </label>
                            <input class="field__input pr-12 large:pr-[4.75rem]"
                                id="Search-In-Template"
                                type="search"
                                name="q"
                                value="{{ search.terms | escape }}"
                                placeholder="{{ 'general.search.search' | t }}"
                                {%- if settings.predictive_search_enabled -%}
                                    role="combobox"
                                    aria-expanded="false"
                                    aria-owns="predictive-search-results-list"
                                    aria-controls="predictive-search-results-list"
                                    aria-haspopup="listbox"
                                    aria-autocomplete="list"
                                    autocorrect="off"
                                    autocomplete="off"
                                    autocapitalize="off"
                                    spellcheck="false"
                                {%- endif -%}
                            >
                            <input name="options[prefix]" type="hidden" value="last">
                            {%- if settings.predictive_search_enabled -%}
                                <div class="predictive-search predictive-search--dropdown" tabindex="-1" data-predictive-search>
                                    <div class="predictive-search__loading-state">
                                        <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                                            <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                                        </svg>
                                    </div>
                                </div>
                                <span class="predictive-search-status hidden" role="status" aria-hidden="true"></span>
                            {%- endif -%}
                            <button type="submit" class="absolute top-0 right-0 h-12 px-[0.875rem] large:px-4" aria-label="{{ 'general.search.search' | t }}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M15.535 15.535L19 19M17.9999 9.52863C17.9999 14.239 14.194 18.0573 9.5005 18.0573C4.80588 18.0573 1 14.239 1 9.52975C1 4.81712 4.80587 1 9.49937 1C14.194 1 17.9999 4.81825 17.9999 9.52863Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                  </svg>
                            </button>
                        </div>
                    </form>
                {%- if settings.predictive_search_enabled -%}
                    </predictive-search>
                {%- endif -%}
            </div>
        </div>
    </div>
    {%- if search.performed -%}
        <div id="collection-layout" class="pt-7 pb-28 bg-uiMidGrey">
            {%- unless section.settings.enable_filtering or section.settings.enable_sorting -%}
                {%- if search.results_count > 0 -%}
                    <div class="container">
                        <div class="wrap">
                            <p role="status" class="mb-12">
                                {{- 'templates.search.results_with_count_and_term' | t: terms: search.terms, count: search.results_count -}}
                            </p>
                        </div>
                    </div>
                {%- endif -%}
            {%- endunless -%}
            {%- if search.results_count == 0 and search.filters == empty -%}
                <div class="container">
                    <div class="wrap">
                        <p role="status" class="mb-12">
                            {{- 'templates.search.no_results' | t: terms: search.terms -}}
                        </p>
                    </div>
                </div>
            {%- endif -%}
            {%- if search.filters != empty -%}
                {%- if section.settings.enable_filtering or section.settings.enable_sorting -%}
                    <aside id="main-search-filters"
                        class="facets-wrapper{% unless section.settings.enable_filtering %} facets-wrapper--no-filters{% endunless %}"
                        data-id="{{ section.id }}"
                        aria-labelledby="verticalTitle"
                    >
                        <div class="container">
                            <div class="wrap">
                                {% render 'facets',
                                    results: search,
                                    enable_filtering: section.settings.enable_filtering,
                                    enable_sorting: section.settings.enable_sorting,
                                    filter_type: section.settings.filter_type,
                                    filter_type: 'horizontal',
                                    enable_product_count: true,
                                    hide_product_count_desktop: false
                                %}
                            </div>
                        </div>
                    </aside>
                {%- endif -%}
            {%- endif -%}
            <div id="ProductGridContainer" class="product-grid-container mt-8">
                <div class="container">
                    <div class="wrap">
                        {%- if search.results.size == 0 and search.filters != empty -%}
                            <div id="product-grid" class="collection collection--empty relative mt-8 mb-[5.625rem] large:mt-11 large:mb-28" data-id="{{ section.id }}">
                                <div class="loading-overlay loading-overlay--collection"></div>
                                <h2 class="title-small">
                                    {{- 'sections.collection_template.empty' | t -}}
                                </h2>
                                <p class="mt-4">
                                    {{- 'sections.collection_template.use_fewer_filters_html' | t: link: search_url, class: "link" -}}
                                </p>
                            </div>
                        {%- else -%}
                            {% paginate search.results by 24 %}
                                <div class="collection relative">
                                    <div class="loading-overlay loading-overlay--collection"></div>
                                    <ul id="product-grid" class="grid grid-cols-2 large:grid-cols-4 gap-x-5 gap-y-6 large:gap-y-12" data-id="{{ section.id }}">
                                        {%- for item in search.results -%}
                                            {% assign lazy_load = false %}
                                            {%- if forloop.index > 4 -%}
                                                {%- assign lazy_load = true -%}
                                            {%- endif -%}
                                            <li class="grid__item">
                                                {%- case item.object_type -%}
                                                {%- when 'product' -%}
                                                    {% render 'card-product',
                                                        card_product: item,
                                                        show_vendor: section.settings.show_vendor,
                                                        lazy_load: lazy_load
                                                    %}
                                                {%- when 'article' -%}
                                                    {% render 'card-article',
                                                        article: item,
                                                        show_image: section.settings.article_show_image,
                                                        show_date: section.settings.article_show_date,
                                                        show_author: section.settings.article_show_author,
                                                        lazy_load: lazy_load
                                                    %}
                                                {%- when 'page' -%}
                                                    <div class="card-wrapper">
                                                        <div class="card">
                                                            <div class="card__information">
                                                                <h3 class="card__heading">
                                                                    <a href="{{ item.url }}">
                                                                        {{- item.title | truncate: 50 | escape -}}
                                                                    </a>
                                                                </h3>
                                                                <div class="card__badge card__badge--static mt-2">
                                                                    <span class="badge">
                                                                        {{- 'templates.search.page' | t -}}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {%- endcase -%}
                                            </li>
                                        {%- endfor -%}
                                    </ul>
                                    {%- if paginate.pages > 1 -%}
                                        {% render 'pagination', paginate: paginate %}
                                    {%- endif -%}
                                </div>
                            {% endpaginate %}
                        {%- endif -%}
                    </div>
                </div>
            </div>
        </div>
    {%- endif -%}
</div>

{% schema %}
{
    "name": "t:sections.main-search.name",
    "tag": "div",
    "class": "section",
    "settings": [
        {
            "type": "header",
            "content": "t:sections.main-search.settings.header__1.content"
        },
        {
            "type": "checkbox",
            "id": "show_vendor",
            "default": false,
            "label": "t:sections.main-search.settings.show_vendor.label"
        },
        {
            "type": "header",
            "content": "t:sections.main-collection-product-grid.settings.header__1.content"
        },
        {
            "type": "checkbox",
            "id": "enable_filtering",
            "default": true,
            "label": "t:sections.main-collection-product-grid.settings.enable_filtering.label",
            "info": "t:sections.main-collection-product-grid.settings.enable_filtering.info"
        },
        {
            "type": "checkbox",
            "id": "enable_sorting",
            "default": true,
            "label": "t:sections.main-collection-product-grid.settings.enable_sorting.label"
        },
        {
            "type": "header",
            "content": "t:sections.main-search.settings.header__2.content"
        },
        {
            "type": "checkbox",
            "id": "article_show_image",
            "default": true,
            "label": "t:sections.main-search.settings.article_show_image.label"
        },
        {
            "type": "checkbox",
            "id": "article_show_date",
            "default": true,
            "label": "t:sections.main-search.settings.article_show_date.label"
        },
        {
            "type": "checkbox",
            "id": "article_show_author",
            "default": false,
            "label": "t:sections.main-search.settings.article_show_author.label"
        }
    ]
}
{% endschema %}
